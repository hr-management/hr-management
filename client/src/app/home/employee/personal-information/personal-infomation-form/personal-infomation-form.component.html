<form [formGroup]="form" *ngIf="user">
  <mat-card>
    <mat-card-content>
      <mat-card-title>Base Info</mat-card-title>
      <p class="row">
        <img
          [src]="form.value['profilePhoto']"
          alt="avatar"
          class="avatar"
          width="66px"
          height="66px"
        />
        <input
          #avatar
          hidden="true"
          type="file"
          onclick="this.value=null"
          (change)="doHandleAvatarUpload($event)"
        />
        <button
          mat-flat-button
          color="primary"
          (click)="avatar.click()"
          [disabled]="!isEdit"
          [hidden]="hideUplodProfile"
        >
          Upload Profile Picture
        </button>
      </p>

      <p class="row">
        <mat-form-field>
          <mat-label>First Name</mat-label>
          <input
            matInput
            placeholder="First Name"
            formControlName="firstName"
            required
          />
          <mat-error *ngIf="form.controls['firstName'].errors?.['required']">
            Required
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Last Name</mat-label>
          <input
            matInput
            placeholder="Last Name"
            formControlName="lastName"
            required
          />
          <mat-error *ngIf="form.controls['lastName'].errors?.['required']">
            Required
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Middle Name</mat-label>
          <input
            matInput
            placeholder="Middle Name"
            formControlName="middleName"
          />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Preferred Name</mat-label>
          <input
            matInput
            placeholder="Preferred Name"
            formControlName="preferredName"
          />
        </mat-form-field>
      </p>

      <p class="row">
        <mat-form-field>
          <mat-label>Email</mat-label>
          <input
            matInput
            placeholder="Email"
            formControlName="email"
            type="email"
          />
          <mat-error *ngIf="form.controls['email'].errors?.['required']">
            Required
          </mat-error>
          <mat-error *ngIf="form.controls['lastName'].errors?.['email']">
            Please provide valid email
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>BirthDate</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="birthDate"
            [max]="maxDate"
          />
          <mat-datepicker-toggle
            matIconSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Gender</mat-label>
          <mat-select formControlName="gender">
            <mat-option value="male">male</mat-option>
            <mat-option value="female">female</mat-option>
            <mat-option value="I do not wish to answer">
              I do not wish to answer
            </mat-option>
          </mat-select>
        </mat-form-field>
      </p>
    </mat-card-content>
  </mat-card>

  <mat-card style="margin-top: 32px">
    <mat-card-content>
      <mat-card-title>Address</mat-card-title>

      <p class="row">
        <mat-form-field>
          <mat-label>Building</mat-label>
          <input matInput placeholder="Building" formControlName="building" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Street</mat-label>
          <input matInput placeholder="Street" formControlName="street" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>City</mat-label>
          <input matInput placeholder="City" formControlName="city" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>State</mat-label>
          <input matInput placeholder="State" formControlName="state" />
        </mat-form-field>
      </p>
      <p class="row">
        <mat-form-field>
          <mat-label>Zip</mat-label>
          <input
            matInput
            placeholder="Zip"
            formControlName="zip"
            type="number"
          />
          <mat-error
            *ngIf="form.controls['zip'].errors?.['minlength'] || form.controls['zip'].errors?.['maxlength']"
          >
            Zip length must be 6
          </mat-error>
        </mat-form-field>
      </p>
    </mat-card-content>
  </mat-card>

  <mat-card style="margin-top: 32px">
    <mat-card-content>
      <mat-card-title>Contact Phone</mat-card-title>

      <mat-form-field>
        <mat-label>CellPhoneNumber</mat-label>
        <input
          matInput
          placeholder="CellPhoneNumber"
          type="text"
          formControlName="cellPhoneNumber"
        />
        <mat-error
          *ngIf="form.controls['cellPhoneNumber'].errors?.['minlength']"
        >
          min length is 5
        </mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>WorkPhoneNumber</mat-label>
        <input
          matInput
          placeholder="WorkPhoneNumber"
          type="text"
          formControlName="workPhoneNumber"
        />
        <mat-error
          *ngIf="form.controls['workPhoneNumber'].errors?.['minlength']"
        >
          min length is 5
        </mat-error>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <mat-card style="margin-top: 32px" *ngIf="displayCarInfo">
    <mat-card-content>
      <mat-card-title>Car Info</mat-card-title>
      <p class="row">
        <mat-form-field>
          <mat-label>Make</mat-label>
          <input matInput placeholder="make" formControlName="make" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Model</mat-label>
          <input matInput placeholder="model" formControlName="model" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Color</mat-label>
          <input matInput placeholder="color" formControlName="color" />
        </mat-form-field></p
    ></mat-card-content>
  </mat-card>

  <mat-card style="margin-top: 32px">
    <mat-card-content>
      <mat-card-title>Employment</mat-card-title>
      <mat-form-field appearance="fill">
        <mat-label>Visa Title</mat-label>
        <mat-select formControlName="type">
          <mat-option *ngFor="let item of visaTypes" [value]="item">
            {{ item }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Start Date</mat-label>
        <input
          matInput
          [matDatepicker]="pickerStartDate"
          formControlName="startDate"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="pickerStartDate"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerStartDate></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>End Date</mat-label>
        <input
          matInput
          [matDatepicker]="pickerEndDate"
          formControlName="endDate"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="pickerEndDate"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerEndDate></mat-datepicker>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <mat-card style="margin-top: 32px">
    <mat-card-content>
      <mat-card-title>Emergency Contact</mat-card-title>

      <p class="row">
        <mat-form-field>
          <mat-label>First Name</mat-label>
          <input
            matInput
            placeholder="First Name"
            formControlName="efirstName"
          />
        </mat-form-field>
        <mat-form-field>
          <mat-label>Last Name</mat-label>
          <input matInput placeholder="Last Name" formControlName="elastName" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Middle Name</mat-label>
          <input
            matInput
            placeholder="Middle Name"
            formControlName="emiddleName"
          />
        </mat-form-field>
      </p>

      <p class="row">
        <mat-form-field>
          <mat-label>Phone</mat-label>
          <input
            matInput
            placeholder="Phone"
            type="text"
            formControlName="ephone"
          />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Email</mat-label>
          <input
            matInput
            placeholder="Email"
            formControlName="eemail"
            type="email"
          />
          <mat-error *ngIf="form.controls['eemail'].errors?.['email']">
            Please provide valid email
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Relationship</mat-label>
          <input
            matInput
            placeholder="Relationship"
            type="text"
            formControlName="erelationship"
          />
        </mat-form-field>
      </p>
    </mat-card-content>
  </mat-card>

  <mat-card style="margin-top: 32px">
    <mat-card-content>
      <mat-card-title>Documents</mat-card-title>

      <h3>DriverLicense</h3>

      <mat-form-field>
        <mat-select formControlName="driverLicense">
          <mat-option value="Yes">Yes</mat-option>
          <mat-option value="No">No</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="row" *ngIf="form.value['driverLicense'] === 'Yes'">
        <mat-form-field>
          <mat-label>LicenseNumber</mat-label>
          <input
            matInput
            placeholder="LicenseNumber"
            formControlName="dlicenseNumber"
          />
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Expiration Date</mat-label>
          <input
            matInput
            [matDatepicker]="dexpirationDate"
            formControlName="dexpirationDate"
          />
          <mat-datepicker-toggle
            matIconSuffix
            [for]="dexpirationDate"
          ></mat-datepicker-toggle>
          <mat-datepicker #dexpirationDate></mat-datepicker>
        </mat-form-field>

        <div style="margin: 0 24px">
          <a
            *ngIf="form.value['dphoto']"
            target="__blank"
            [href]="form.value['dphoto']"
            >Open File</a
          >
          <div *ngIf="!form.value['dphoto']">No File</div>
        </div>

        <input
          #driverLicense
          hidden="true"
          type="file"
          onclick="this.value=null"
          (change)="doHandleDriverLicenseUpload($event)"
        />
        <button
          mat-flat-button
          color="primary"
          (click)="driverLicense.click()"
          [disabled]="!isEdit"
          [hidden]="hideUplodProfile"
          style="margin-right: 12px"
        >
          Upload File
        </button>
        <button
          mat-flat-button
          color="primary"
          (click)="handleDownload('dphoto')"
          [disabled]="!isEdit || !form.value['dphoto']"
        >
          Download
        </button>
      </div>

      <div class="row">
        <h3 style="margin: 0">WorkAuthDoc</h3>

        <button
          mat-flat-button
          color="primary"
          (click)="handleAddAuthDoc()"
          [disabled]="!isEdit"
          [hidden]="hideUplodProfile"
        >
          Add
        </button>
      </div>

      <mat-form-field>
        <mat-label>Citizenship</mat-label>
        <mat-select
          formControlName="citizenship"
          (change)="onCitizenshipChange($event)"
        >
          <mat-option value="yes">Yes</mat-option>
          <mat-option value="no">No</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field *ngIf="showWorkAuthorization">
        <mat-label>What is your work authorization?</mat-label>
        <mat-select
          formControlName="authorization"
          (change)="onAuthorizationChange($event)"
        >
          <mat-option value="h1-b">H1-B</mat-option>
          <mat-option value="l2">L2</mat-option>
          <mat-option value="f1">F1</mat-option>
          <mat-option value="h4">H4</mat-option>
          <mat-option value="other">Other</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="row" style="width: 1000px">
        <table formArrayName="workAuthDoc">
          <tr>
            <th>Work authorization</th>
            <th>Status</th>
            <th>Feedback</th>
            <th>File</th>
            <th>Option</th>
          </tr>
          <tr
            *ngFor="let element of workAuthDocArray; let i = index"
            [formGroupName]="i"
          >
            <td>
              <mat-form-field appearance="fill">
                <mat-select formControlName="type">
                  <mat-option *ngFor="let item of visaTypes" [value]="item">
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field appearance="fill">
                <mat-select formControlName="status">
                  <mat-option
                    *ngFor="let item of workAuthStatus"
                    [value]="item"
                  >
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>

            <td>
              {{ element.value.feedback || "-" }}
            </td>

            <td>
              <a
                *ngIf="element.value['file']"
                target="__blank"
                [href]="element.value['file']"
                >Open File</a
              >
              <div *ngIf="!element.value['file']">No File</div>
            </td>

            <td>
              <input
                #workAuthDoc
                hidden="true"
                type="file"
                onclick="this.value=null"
                (change)="doHandleAuthDocUpload($event, i)"
              />
              <button
                mat-flat-button
                color="primary"
                (click)="workAuthDoc.click()"
                [disabled]="!isEdit"
                [hidden]="hideUplodProfile"
              >
                Upload File
              </button>
              <button
                mat-flat-button
                color="warn"
                (click)="handleDeleteAuthDoc(i)"
                [disabled]="!isEdit"
                [hidden]="hideUplodProfile"
              >
                DELETE
              </button>
            </td>
          </tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</form>
